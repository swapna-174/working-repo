-- Database: Cogito Classic
-- Query Type: Standard Query
-- Optimizations applied: Simplify Expressions, Filter to Where Exists, Use Primary Keys in Clauses, Remove Dimension Tables, Query Consolidation
SET TRANSACTION ISOLATION LEVEL SNAPSHOT


SELECT DISTINCT mainResultSet.count0 AS count0 ,
     mainResultSet.count1 AS count1
FROM  ( 
    SELECT COUNT_BIG  (  EncounterKey  )  AS count0 ,
         COUNT_BIG  (  EncounterKey  )  AS count1
    FROM  ( 
        SELECT subq0.EncounterKey AS EncounterKey,
            NULL AS count0,
            NULL AS count1
        FROM  ( 
            SELECT RootTable0.EncounterKey AS EncounterKey,
                 NULL AS count0 ,
                 NULL AS count1
            FROM dbo.EncounterFact AS RootTable0
            WHERE  ( 
                 ( 
                     (   (  RootTable0.DateKey < '20260220'  )  AND NOT  (  RootTable0.DateKey < 0  )   )  AND  (   (  RootTable0.DateKey >= '20250820'  )  OR  (  RootTable0.DateKey < 0  )   ) 
                 )  AND  ( 
                    RootTable0.PatientDurableKey IN  ( 
                        SELECT DurableKey
                        FROM PatientDim
                        WHERE IsValid = 1 AND IsCurrent = 1 AND IsHistoricalPatient = 0
                     )  AND RootTable0.IsDerivedFromBilling = 0
                 )  AND  ( 
                    RootTable0.SourceKey IN  (  1, 2, 3, 4, 6, 7, 9, 10, 11, 12, 13, 14, 15, 16, 19, 20, 21, 24, 49148, 55671, 55673, - 1  ) 
                 )  AND RootTable0.IsEdVisit = '1' AND  (   (  RootTable0.PatientClass = 'Emergency'  )  OR  (  RootTable0.PatientClass = 'Outpatient'  )   )  AND  (   (  RootTable0.Type = 'Hospital'  )  OR  (  RootTable0.Type = 'Hospital Encounter'  )   )  AND EXISTS  ( 
                    SELECT 1
                    FROM dbo.DepartmentDim AS FilterTable1
                    WHERE  ( 
                          (  FilterTable1.ServiceAreaEpicId = '10'  )  AND  (   (  RootTable0.DepartmentKey = FilterTable1.DepartmentKey  )   ) 
                     ) 
                 ) 
             ) 
         )  subq0
        INNER JOIN  ( 
            SELECT EncounterKey,
                NULL AS count0,
                NULL AS count1
            FROM  ( 
                SELECT subq0.EncounterKey AS EncounterKey,
                    NULL AS count0,
                    NULL AS count1
                FROM  ( 
                     ( 
                        SELECT NULL AS count0 ,
                             NULL AS count1 ,
                            RootTable0.EncounterKey AS EncounterKey
                        FROM dbo.EncounterFact AS RootTable0
                        WHERE  ( 
                             ( 
                                 (   (  RootTable0.DateKey < '20260220'  )  AND NOT  (  RootTable0.DateKey < 0  )   )  AND  (   (  RootTable0.DateKey >= '20250820'  )  OR  (  RootTable0.DateKey < 0  )   ) 
                             )  AND  ( 
                                RootTable0.PatientDurableKey IN  ( 
                                    SELECT DurableKey
                                    FROM PatientDim
                                    WHERE IsValid = 1 AND IsCurrent = 1 AND IsHistoricalPatient = 0
                                 )  AND RootTable0.IsDerivedFromBilling = 0
                             )  AND  ( 
                                RootTable0.SourceKey IN  (  1, 2, 3, 4, 6, 7, 9, 10, 11, 12, 13, 14, 15, 16, 19, 20, 21, 24, 49148, 55671, 55673, - 1  ) 
                             )  AND EXISTS  ( 
                                SELECT 1
                                FROM dbo.DepartmentDim AS FilterTable1
                                WHERE  ( 
                                      (  FilterTable1.LocationEpicId = '10011'  )  AND  (  FilterTable1.IsDepartment = 1  )  AND  (  RootTable0.AttributedDepartmentKey = FilterTable1.DepartmentKey  ) 
                                 ) 
                             ) 
                         ) 
                     )  UNION  ( 
                        SELECT NULL AS count0 ,
                             NULL AS count1 ,
                            RootTable0.EncounterKey AS EncounterKey
                        FROM dbo.EncounterFact AS RootTable0
                        WHERE  ( 
                             ( 
                                 (   (  RootTable0.DateKey < '20260220'  )  AND NOT  (  RootTable0.DateKey < 0  )   )  AND  (   (  RootTable0.DateKey >= '20250820'  )  OR  (  RootTable0.DateKey < 0  )   ) 
                             )  AND  ( 
                                RootTable0.PatientDurableKey IN  ( 
                                    SELECT DurableKey
                                    FROM PatientDim
                                    WHERE IsValid = 1 AND IsCurrent = 1 AND IsHistoricalPatient = 0
                                 )  AND RootTable0.IsDerivedFromBilling = 0
                             )  AND  ( 
                                RootTable0.SourceKey IN  (  1, 2, 3, 4, 6, 7, 9, 10, 11, 12, 13, 14, 15, 16, 19, 20, 21, 24, 49148, 55671, 55673, - 1  ) 
                             )  AND  (  RootTable0.AttributedDepartmentKey = '20393'  ) 
                         ) 
                     ) 
                 )  subq0
             )  subqset1
         )  subq1
        ON subq0.EncounterKey = subq1.EncounterKey
     )  subq
    WHERE subq.EncounterKey > 0
 )  mainResultSet
OPTION  (  RECOMPILE, USE HINT  (  'FORCE_DEFAULT_CARDINALITY_ESTIMATION', 'DISABLE_OPTIMIZER_ROWGOAL'  ) , NO_PERFORMANCE_SPOOL  )  
